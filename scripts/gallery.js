/*
  {
    src: "",
    alt: "",
    author: "",
  },
*/

let images = [
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape8.jpg?v=1725051075142",
    alt: "A mountain topped with snow under a blue, sunny sky. In the foreground is a dark green forest.",
    author: "Léto le Gaosaure",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset7.jpg?v=1725051072604",
    alt: "A valley at night. On the left, the black silhouette of mountain tops against the sky, on the right the same for trees. In the center, there are lights in the distance showing human activity in the middle of darkness. The sky is a gradient from very dark blue on the top left corner to a pale blue with hints of pink in the bottom right.",
    author: "Léto le Gaosaure",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset8.jpg?v=1725051068758",
    alt: "A mountain at night, creating a black silhouette of mountain tops and trees against the sky, which is a gradient from dark blue at the top to a pale blue where it meets the mountain.",
    author: "Léto le Gaosaure",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape7.jpg?v=1725051068123",
    alt: "A mountain lake, its water a surprisingly deep green. Trees surround the lake. In the distance there's a rocky mountain top. The whole pic is sunny but there are clouds in the sky. There's a rock in the foreground.",
    author: "Léto le Gaosaure",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape6.jpg?v=1725050850384",
    alt: "Several milk cows far away in a green field with a forest behind them. The cows are staring at the camera",
    author: "Eine",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/leaves2.jpg?v=1725050846446",
    alt: "A close up picture of a stringy plant with lots of water droplets on it",
    author: "Eine",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/leaves1.jpg?v=1725050843788",
    alt: "The end of a thistle or a similar plant that has fallen off and landed on a big leaf",
    author: "Eine",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset6.jpg?v=1725046598812",
    alt: "Field at sunset. Caravan to the right of the photograph, with the main focus being on the sun setting over the sea's horizon. Orange skies and grey-blue sea highlights the beauty of this calm scene.",
    author: "Lexicaleigh",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape5.jpg?v=1725046595804",
    alt: "A freshly cut field, with a lovely calming blue sea in the background. Blue skies overhead with wispy clouds on the left.",
    author: "Lexicaleigh",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape4.jpg?v=1725045996204",
    alt: "A pebbly path stretching from the bottom of the picture, curving slightly to the right as it moves onwards. The path is bordered by log posts, and both sides are surrounded by various tall greenery. At the very back of the picture, one can see a blue, yet cloudy, slice of sky.",
    author: "Raeyn",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers6.jpg?v=1725045866385",
    alt: "a bright daffodil, fully opened to the camera.",
    author: "Mx. Duck",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset5.jpg?v=1725045743707",
    alt: "Overlooking the pacific ocean from the North Oregon Coast, on a typically cloudy, moody day, sun a glowing orb obscured by clouds in an otherwise gray sky.",
    author: "Mx. Duck",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/moss0.jpg?v=1725045042257",
    alt: "water just about to drop off a lichen-covered rock, green moss looking on.",
    author: "Mx. Duck",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers5.jpg?v=1725044917630",
    alt: "a blue african violet bloom facing the camera, behind which more blooms seem to go off into forever.",
    author: "Mx. Duck",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/fireplace0.jpg?v=1724968977804",
    alt: "An iron fireplace with a fire burning merrily inside. You can see it through the closed glass door. There's a board and a stick in front of it, and the stick is fairly burnt at one end as it's being used as a poker.",
    author: "Dion",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/trees2.jpg?v=1724968790796",
    alt: "A tall birch tree with mostly green leaves, but one branch right in the middle has bright yellow leaves. The sky is blue.",
    author: "Dion",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/trees1.jpg?v=1724968783841",
    alt: "A small gravel driveway leading away from a house, lined by a small wooden fence and surrounded by a lot of greenery, with green grass growing between the gravel tracks as well. Three trees can be seen towards the end of the drive. Beyond the driveway is a small road and beyond that lie open fields and a forest in the distance. A small portion of a red house can be seen on the lefthand side. There are no other houses in sight. The sky is very blue.",
    author: "Dion",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset4.jpg?v=1724968320684",
    alt: "sunset behind a green flat field with sone groups of trees near the horizon. The clouds near the horizon are glowing in orange and pink, with softer pink farther away and some blue clouds above that. The clouds look windswept. Above them is soft blue sky.",
    author: "Aurin",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/berries0.jpg?v=1724968214031",
    alt: "Branch of red currant berries, hanging full of little red berries, so much that there's more red from the berries than green from the leaves.",
    author: "Aurin",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape3.jpg?v=1724966939643",
    alt: "A serene and peaceful lake, with half-shaded and half-sunlit grass in the foreground at the bottom and the hanging fronds of a willow tree in the foreground in the top left. There are some reeds on the right. There are very gentle ripples on the water of the lake, and forests on the far banks. The sky is a light blue with a few small clouds.",
    author: "Aurin",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape2.jpg?v=1724964274314",
    alt: "wide open high moorland with a path running on into the distance, almost never-ending. The path is delineated by stone boulders to avoid foundering in the mires either side. The moor stretches on into the distance under blue skies across which white clouds scud.",
    author: "Happy Bimbling",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/bugs0.jpg?v=1724949532812",
    alt: "a single, thin blade of green marsh grass rising at a slight, left-leaning angle against an expanse of other tall, green reeds and wetland grasses in soft focus beyond. Climbing the blade in profile is a glossy little Harlequin ladybird like a tiny, red-orange, spotted cabochon, little bronze legs shimmying and mouthparts touching grass.",
    author: "handmade ghost",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/birds1.jpg?v=1724949482589",
    alt: "Hazy photo of seven American white pelicans standing in a horizontal row along some mostly submerged rock at the mouth of a river. The early morning air is dark with wildfire smoke, giving everything a close, slightly staged feel; the heavy willows in the background overhang the water like shaggy shadows, and the water itself, nearly still and glassily reflective, is an eldritch olive green hazed with dark goal from the sun, held at arm's length above by the oppressive smoke. The pelicans are spaced about a foot or two away each to each and variously preening their enormous, plump white bodies with the heavy orange bowstrings of their long, thick bills,  running those bows across the upright basses of their breasts, lifting them to the tidy violins of their throats, drawing them across the dusky cellos of their short pants which close in soft cuffs over the bright orange endpins of their legs. A tiny flight of mallards drifts by behind them, looking for their seats in the mezzanine above the water.",
    author: "handmade ghost",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/birds0.jpg?v=1724949363572",
    alt: "A smooth, reflective sheet of water flooding a field of earth and reeds along a wetland slough in rural Oregon. In the near distance at the top of the picture is a richly green, grassy mound with the water reappearing beyond. The photo is otherwise this wonderful mirror of blue-grey. In a smoothly staggered row along the upper portion, and scattered here and there, are  long, curving reeds that arc to the right, their reflections below them as clear and real as they are, bending through the quiet light at play on the water like an oil painting. On one of two small, muddy patches that like gravelly shadows on the water, in right-facing profile, stands a slender black and white shorebird with long, thin pink legs and a long bill like a black tapestry needle. The bird, a black-necked stilt, is staring into the water, eir reflection below not as clear or real as the reeds' but ready to welcome us, if we choose to follow, into another world.",
    author: "handmade ghost",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers4.jpg?v=1724949012356",
    alt: "Tiny white flowers on long green stems.",
    author: "Rainbow",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers2.jpg?v=1724948434776",
    alt: "A large white flower tinged with pink on the edges, with a delicate yellow center.",
    author: "Rainbow",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/branches0.jpg?v=1724948454196",
    alt: "A pussywillow twig hanging down through the middle of the photo. It's in focus while the background, a fence with some trees and sunlight, is blurry.",
    author: "Rainbow",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/leaves0.jpg?v=1724948827237",
    alt: "A close-up of some dark green ivy leaves with prominent veins.",
    author: "Rainbow",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers3.jpg?v=1724948929397",
    alt: "Dark pink flowers on a twiggy bush.",
    author: "Rainbow",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers1.jpg?v=1724857446819",
    alt: "vivid purple-pink flowers that resemble small clustered daisies sit amongst green foliage.",
    author: "lee",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/butterfly0.jpg?v=1724783766292",
    alt: "an 'orange-tip' butterfly, which is coloured orange and brown with brown spots on its wings, is resting on a cluster of white yarrow flowers. there is some green grass out of focus in the background.",
    author: "laen",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset0.jpg?v=1724774474618",
    alt: "Sunset over a cliff in St Davids, West Wales, UK. The sky is blue with golden clouds adorning it, the cliff looks black in the night-time shadows, and there is a bright orange/yellow strip over the grey sea as the sun goes down.",
    author: "Lexicaleigh",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape1.png?v=1724783841335",
    alt: "a countryside scene. the sky is grey with darker grey clouds, and on the horizon are a line of leafy green trees; there are also a couple of large individual trees between the horizon line and the rest of the image. the trees are mostly oak. the ground is covered in grass and wildflowers: purple, violet, white, yellow, and pink. at the front of the image on the right, there's a big, round hay bale, and there are a few others further back too.",
    author: "laen",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/flowers0.jpg?v=1724783449003",
    alt: "close up on flowers, potentially pansies, in a pot. They have vivid pink centers fading out to white petal edges, and bold yellow stripes in between each petal body.",
    author: "lee",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/beach0.jpg?v=1724783724597",
    alt: "from the sandy and grassy shore of a lake, the water stretches away to the horizon of very distant trees. above them is a layer of puffy white clouds with flat grey bottoms, and above the clouds is clear blue sky. the water itself is very clear and showing the reflections of the clouds in places. there is a patch of green-brown grasses just out from the shore, and beyond them, blue water on which rest several white sailboats.",
    author: "laen",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset1.jpg?v=1724776018689",
    alt: "Sunset over a cliff in St Davids, West Wales, UK. The sky is purple, pink, and orange, with a tiny 'dot' as the sun sets down over the sea. There is a field in the foreground but it's so dark you almost can't see it.",
    author: "Lexicaleigh",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/beach1.png?v=1724783744728",
    alt: "a square of water. this photo was taken of clear lake water on very sunny day. the bottom of the image is a rippling yellow-green with lighter and darker patches where the pale sand underneath is in sunshine or shadow. as you move up the image, the colours become more blue and the ripples become smaller. the water at the top of the image is quite a dark blue with many small ripples in it.",
    author: "laen",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/landscape0.png?v=1724785288592",
    alt: "Dowth burial mounds at Bru na Boine, County Meath, Ireland. On the right is large grass covered mound, In front and to the left of it are 3 smaller grass covered mounds. There is a black rock path from the left foreground to the right of the 3 smaller mounds. There is lush grass on either side of the path leading up the hill to the mounds.",
    author: "somcak",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset2.jpg?v=1724774724805",
    alt: "Sunset over a cliff in St Davids, West Wales, UK. The sky is yellowy-orange as the sun sets over a blue-grey sea. A few strips of golden cloud are the only things in the sky, as the sun melts into the horizon. A black-looking cliff in the foreground contrasts the colours nicely.",
    author: "Lexicaleigh",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/butterfly1.jpg?v=1724783783767",
    alt: "a 'common blue' blue butterfly on yellow saint john's wort flowers. there are some green leaves and dried brown grasses in the background.",
    author: "laen",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/sunset3.jpg?v=1724774792715",
    alt: "Sun setting over a beach in St David's, West Wales, UK. The ocean is rippling with waves, and there are some rocks emerging as the tide washes away. Sunset is orange with a bright yellow sky.",
    author: "LexicaLeigh",
  },
  {
    src: "https://cdn.glitch.global/2854b33d-65dd-4098-af74-9ea08324c083/beach2.png?v=1724783807589",
    alt: "a tall image of a small, diagonal wave breaking on golden-brown sand. the wave has a small white patch just where it's breaking, but the rest of it is a clear, pale aquamarine. behind the wave, the water is a darker blue, and in front of it, there's just clear, slightly rippling water over sunlit sand.",
    author: "laen",
  },
];

function shuffle(array) {
  var m = array.length,
    t,
    i;

  // While there remain elements to shuffle…
  while (m) {
    // Pick a remaining element…
    i = Math.floor(Math.random() * m--);

    // And swap it with the current element.
    t = array[m];
    array[m] = array[i];
    array[i] = t;
  }

  return array;
}

/* Manage modal full-screen image */
let modal = document.createElement("dialog");
modal.id = "gallery-modal";

function buildModal(target) {
  modal.innerHTML = "";

  let caption = document.createElement("p");
  caption.id = "modal-caption";
  caption.innerText = target.alt;

  let image = document.createElement("img");
  image.id = "modal-img";
  image.src = target.src;
  image.setAttribute("aria-describedby", caption.id);

  let attribution = document.createElement("p");
  attribution.id = "modal-attribution";
  attribution.innerText = target.title;

  modal.appendChild(image);
  modal.appendChild(attribution);
  modal.appendChild(caption);
}

function toggleModal() {
  if (modal.open) modal.close();
  else modal.showModal();
}

function createModal(event) {
  let target = event.target;
  buildModal(target);
  target.after(modal);

  toggleModal();
  modal.addEventListener("click", toggleModal);
  modal.addEventListener("keyup", toggleModal);
}

function createModalOnEnter(event) {
  if (event.key === "Enter" || event.key === " ") createModal(event);
}

// create an image and return it
function makeImage({ src, alt, author }) {
  let image = document.createElement("img");
  image.className = "gallery-img";
  image.src = src;
  image.alt = alt;
  image.title = "author: " + author;

  image.tabIndex = 0;
  image.addEventListener("click", createModal);
  image.addEventListener("keyup", createModalOnEnter)

  return image;
}

function makeCols(cols, amt) {
  for (let i = 0; i < amt; i++) {
    cols.push(document.createElement("div"));
  }
}

let gallery = document.getElementById("gallery");
images = shuffle(images);

function fitGalleryToWindow() {
  gallery.innerHTML = "";
  let numCols = Math.floor(window.innerWidth / 300);

  if (numCols === 0) numCols = 1;
  else if (numCols > 7) numCols = 7;

  let cols = [];
  makeCols(cols, numCols);

  let currentCol = 0;

  for (let index = 0; index < images.length; index++) {
    if (currentCol === cols.length) currentCol = 0;
    cols[currentCol].appendChild(makeImage(images[index]));
    currentCol++;
  }

  for (let index = 0; index < cols.length; index++) {
    cols[index].className = "gallery-col";
    gallery.appendChild(cols[index]);
  }
}

fitGalleryToWindow();

window.addEventListener("resize", fitGalleryToWindow);
